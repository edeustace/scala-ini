@(puzzle : Puzzle, url : String)(implicit flash: play.api.mvc.Flash) 

@htmlSafe(s:String) = @{
  var out = s.replace("\\", "\\\\")
  out = out.replace("\n", "\\n")
  out = out.replace("\"", "\\\"")
  Html(out)
}


@postBodyScript = {
<script type="text/javascript" src="@routes.Assets.at("javascripts/LoadingButton.js")"></script>
<script type="text/javascript" src="/assets/javascripts/string-update-processor.js"></script>
<script type="text/javascript" src="@routes.Assets.at("javascripts/InfoBox.js")"></script>
<script type="text/javascript" src="@routes.Assets.at("javascripts/EvaluationHighlighter.js")"></script>
<script type="text/javascript" src="@routes.Assets.at("javascripts/SinglePuzzleView.js")"></script>
<script type="text/javascript">
  
  $(document).ready(function(){
      
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/twilight");
      editor.getSession().setTabSize(4);
      editor.setHighlightActiveLine(true);
      editor.setShowPrintMargin(false);
      editor.renderer.setShowGutter(true);
      var ScalaMode = ace.require("ace/mode/scala").Mode;
      editor.getSession().setMode(new ScalaMode());
      window.ace = (window.ace || {});
      window.ace.editor = editor;
      editor.getSession().setValue( "@htmlSafe(puzzle.body)" );
      console.log("setting url to: /puzzles/solve")

      var view = new com.ee.SinglePuzzleView( "/puzzles/solve", editor) 
      view.setPuzzle( "@htmlSafe(puzzle.body)" )
      
      editor.commands.addCommand({
          name: 'myCommand',
          bindKey: {
              win: 'Ctrl-R',
              mac: 'Ctrl-R',
              sender: 'editor'
          },
          exec: function(env, args, request) {
            view.runCode();
          }
      });
  });
</script>
}


@mainContent = {

<div class="editor-main-area">
  <div class="padded-10 max-width run-bar">
    <div>
      <a 
        href="javascript:void(1)" 
        id="runButton" 
        class="btn btn-primary btn-large">
          <i class="icon-refresh"></i> Run
      </a>
      &nbsp;
      <span 
        class="title" 
        id="main-puzzle-title">Solve me!</span>
      &nbsp;
      -
      <span class="subheader" id="main-puzzle-subheader"></span>
      <!-- facebook --> 
      <div 
        class="fb-like" 
        data-href="@url" 
        data-send="true" 
        data-width="450" 
        data-show-faces="false" 
        data-font="arial"></div>

        <!-- twitter -->
        <a href="https://twitter.com/share" 
            class="twitter-share-button" 
            data-count="none" 
            data-hashtags="scalapuzzles">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    </div>
    <div>
  </div>
</div>

 
  <pre id="editor" >/* write your code here [Ctrl-R runs it]*/</pre>

  <div class="errorBoxHolder padded-10">
    <div id="successBox" class="alert alert-success invisible"></div>
    <div id="errorBox" class="alert alert-error invisible">
    </div>
  </div>  
</div>
}

@base("Solve me...", null)(mainContent, postBodyScript)

